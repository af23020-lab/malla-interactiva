<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Malla Curricular Interactiva</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f3f6fa;
        margin: 0;
        padding: 20px;
    }
    h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
    }
    .grid {
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        gap: 12px;
    }
    .ciclo-title {
        font-weight: bold;
        background: #d9e4f5;
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        grid-column: span 1;
    }
    .materia {
        background: #ffffff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 5px #0001;
        cursor: pointer;
        border-left: 6px solid #7da4d0;
        transition: 0.2s;
        position: relative;
    }
    .materia.completed {
        background: #c7ffd4;
        border-left-color: #28a745;
        text-decoration: line-through;
    }
    .materia.locked {
        background: #eee;
        border-left-color: #999;
        cursor: not-allowed;
    }
    .tooltip {
        visibility: hidden;
        background: #333;
        color: #fff;
        padding: 5px 8px;
        border-radius: 5px;
        font-size: 12px;
        position: absolute;
        top: -5px;
        left: 105%;
        white-space: nowrap;
    }
    .materia.locked:hover .tooltip {
        visibility: visible;
    }
</style>
</head>
<body>

<h1>Malla Curricular Interactiva</h1>

<div class="grid" id="grid"></div>

<script>
const materias = [
    // CICLO 1
    { codigo: "BEM131", nombre: "Bioética Médica", uv: 6, ciclo: 1, req: [] },
    { codigo: "BIG131", nombre: "Biología General", uv: 6, ciclo: 1, req: [] },
    { codigo: "HIA131", nombre: "Historia de la Anestesia", uv: 4, ciclo: 1, req: [] },
    { codigo: "PSG131", nombre: "Psicología I", uv: 6, ciclo: 1, req: [] },

    // CICLO 2
    { codigo: "ANH131", nombre: "Anatomía Humana", uv: 6, ciclo: 2, req: ["BIG131"] },
    { codigo: "GEA131", nombre: "Generalidades en Anestesiología", uv: 6, ciclo: 2, req: ["HIA131"] },
    { codigo: "PSG231", nombre: "Psicología II", uv: 4, ciclo: 2, req: ["PSG131"] },
    { codigo: "QUG131", nombre: "Química General", uv: 4, ciclo: 2, req: ["BIG131"] },

    // CICLO 3
    { codigo: "IGT131", nombre: "Inglés Técnico", uv: 4, ciclo: 3, req: ["BEM131"] },
    { codigo: "PBF131", nombre: "Principios Básicos de Farmacología", uv: 6, ciclo: 3, req: ["GEA131"] },
    { codigo: "VPP131", nombre: "Valoración y Preparación Pre Anestésica", uv: 7, ciclo: 3, req: ["HIA131"] },
    { codigo: "VAE131", nombre: "Vía Aérea", uv: 4, ciclo: 3, req: ["ANH131"] },

    // CICLO 4
    { codigo: "AGR131", nombre: "Anestesia General y Regional", uv: 5, ciclo: 4, req: ["VPP131"] },
    { codigo: "FAA131", nombre: "Farmacología Aplicada a la Anestesia I", uv: 6, ciclo: 4, req: ["PBF131"] },
    { codigo: "MEA131", nombre: "Monitorización en Anestesia", uv: 6, ciclo: 4, req: ["GEA131"] },
    { codigo: "QOG131", nombre: "Química Orgánica General", uv: 4, ciclo: 4, req: ["QUG131"] },

    // CICLO 5
    { codigo: "FAA231", nombre: "Farmacología Aplicada a la Anestesia II", uv: 4, ciclo: 5, req: ["FAA131"] },
    { codigo: "FIH131", nombre: "Fisiología Humana", uv: 6, ciclo: 5, req: ["FAA131"] },
    { codigo: "PRA131", nombre: "Práctica I", uv: 6, ciclo: 5, req: ["AGR131"] },
    { codigo: "TEA131", nombre: "Técnicas Anestésicas", uv: 4, ciclo: 5, req: ["AGR131"] },

    // CICLO 6
    { codigo: "BIE131", nombre: "Bioestadística", uv: 4, ciclo: 6, req: ["QUG131"] },
    { codigo: "FPR131", nombre: "Fisiología Pulmonar y Terapia Respiratoria", uv: 4, ciclo: 6, req: ["FIH131"] },
    { codigo: "PRA231", nombre: "Práctica II", uv: 6, ciclo: 6, req: ["PRA131"] },
    { codigo: "TAE131", nombre: "Técnicas Anestésicas Especializadas I", uv: 6, ciclo: 6, req: ["TEA131"] },

    // CICLO 7
    { codigo: "EPI131", nombre: "Epidemiología", uv: 4, ciclo: 7, req: ["QOG131"] },
    { codigo: "MEI131", nombre: "Metodología de la Investigación I", uv: 6, ciclo: 7, req: ["BEM131"] },
    { codigo: "PRA331", nombre: "Práctica III", uv: 6, ciclo: 7, req: ["PRA231"] },
    { codigo: "TAE231", nombre: "Técnicas Anestésicas Especializadas II", uv: 6, ciclo: 7, req: ["TAE131"] },

    // CICLO 8
    { codigo: "ASD131", nombre: "Anestesia en Situaciones de Desastres", uv: 4, ciclo: 8, req: ["TAE231"] },
    { codigo: "MEI231", nombre: "Metodología de la Investigación II", uv: 6, ciclo: 8, req: ["MEI131"] },
    { codigo: "PRA431", nombre: "Práctica IV", uv: 6, ciclo: 8, req: ["PRA331"] },

    // CICLO 9
    { codigo: "APU131", nombre: "Anestesia en Pacientes UCI", uv: 4, ciclo: 9, req: ["MEA131"] },
    { codigo: "AEC131", nombre: "Anestesia y Enfermedades Coexistentes I", uv: 4, ciclo: 9, req: ["TAE231"] },
    { codigo: "NSA131", nombre: "Normativas de Salud Aplicadas a la Anestesia", uv: 4, ciclo: 9, req: ["GEA131"] },

    // CICLO 10
    { codigo: "AEC231", nombre: "Anestesia y Enfermedades Coexistentes II", uv: 4, ciclo: 10, req: ["AEC131"] },
    { codigo: "DOS131", nombre: "Defensa de Seminario", uv: 4, ciclo: 10, req: ["MEI231"] },
    { codigo: "REA131", nombre: "Redacción de Textos Académicos", uv: 4, ciclo: 10, req: ["MEI131", "MEI231"] }
];

// ------ GENERAR MALLA ------
function generar() {
    const grid = document.getElementById("grid");

    for (let c = 1; c <= 10; c++) {
        const t = document.createElement("div");
        t.className = "ciclo-title";
        t.innerText = "Ciclo " + c;
        grid.appendChild(t);

        materias.filter(m => m.ciclo === c).forEach(m => {
            const div = document.createElement("div");
            div.className = "materia";
            div.id = m.codigo;

            div.innerHTML = `
                <strong>${m.codigo}</strong><br>
                ${m.nombre}<br>
                <small>${m.uv} UV</small>
                <div class="tooltip"></div>
            `;

            div.addEventListener("click", () => toggleMateria(m.codigo));
            grid.appendChild(div);
        });
    }

    actualizarEstado();
}

// ------ ACTUALIZAR ESTADO ------
function actualizarEstado() {
    const aprobadas = JSON.parse(localStorage.getItem("aprobadas") || "[]");

    materias.forEach(m => {
        const div = document.getElementById(m.codigo);
        div.classList.remove("completed", "locked");

        const faltantes = m.req.filter(r => !aprobadas.includes(r));

        if (faltantes.length === 0) {
            div.querySelector(".tooltip").innerText = "";
            if (aprobadas.includes(m.codigo)) div.classList.add("completed");
        } else {
            div.classList.add("locked");
            div.querySelector(".tooltip").innerText = "Falta: " + faltantes.join(", ");
        }
    });
}

// ------ MARCAR / DESMARCAR ------
function toggleMateria(codigo) {
    const aprobadas = JSON.parse(localStorage.getItem("aprobadas") || "[]");
    const materia = materias.find(m => m.codigo === codigo);

    const faltantes = materia.req.filter(r => !aprobadas.includes(r));
    if (faltantes.length > 0) return; // Bloqueada

    if (aprobadas.includes(codigo)) {
        aprobadas.splice(aprobadas.indexOf(codigo), 1);
    } else {
        aprobadas.push(codigo);
    }

    localStorage.setItem("aprobadas", JSON.stringify(aprobadas));
    actualizarEstado();
}

generar();
</script>

</body>
</html>
